"use strict";let contact={};let products=[];function showProductsInCart(){let cartItems=localStorage.getItem("productInCart");cartItems=JSON.parse(cartItems);let cartProducts=document.querySelector(".cart-products");if(cartItems&&cartProducts){Object.values(cartItems).map((article)=>{for(let i=0;i<parseInt(article.inCart);i++){products.push(article._id);}
cartProducts.innerHTML+=`
        <div class ="cart-header__title">
            <img class= "img-cart" src= ${article.imageUrl}>
            <span>${article.name}</span>
        </div>
        <div class ="cart-header__price">${article.price / 100} €</div>
        <div class ="cart-header__color">${article.colors}</div>
        <div class ="cart-header__quantity">${article.inCart}</div>
        <div class ="cart-header__total">${ (article.inCart * article.price) / 100 } €</div>
        `;});cartProducts.innerHTML+=`
  <div class ="sub-array">
      <span class ="total-product">Prix total des articles : <b>${localStorage.getItem("totalCost")} €.</b></span>
      <div class="clear-cart">Annuler ?</div>
  </div>`;validForm(products);deleteProduct();}else{checkCartEmpty();}}
function checkCartEmpty(){let cartH1=document.querySelector('.cart-title-page');let cartContainer=document.querySelector('.cart-container');let formHeading=document.querySelector('.form-heading');let form=document.querySelector('form');cartH1.innerHTML="Nous sommes désolés !";cartContainer.remove();formHeading.innerHTML="Votre panier est vide...<br> Veuillez sélectionner des articles dans la page d\'acceuil";formHeading.style.fontSize="1.8rem";formHeading.style.marginBottom="15rem";form.remove();setTimeout(function(){window.location="./index.html"},4000);}
function deleteProduct(){let clearCart=document.querySelector('.clear-cart');clearCart.addEventListener('click',function(){alert('Votre panier à été annulé ! \n Retour à la page d\'acceuil');localStorage.clear();window.location="./index.html";})}
showProductsInCart();function checkInput(){let checkNumber=/[0-9]/;let checkSpecialCharacter=/[&~#"()"|%$^*{}!/><£€µ¤]/;let checkMail=/^\w{2,}@[a-z1-9]{2,}\.[a-z]{1,}$/;let firstName=document.getElementById("first-name").value;let name=document.getElementById("name").value;let address=document.getElementById("address").value;let city=document.getElementById("city").value;let email=document.getElementById("mail").value;let verifyInput="";if(checkNumber.test(firstName)||checkSpecialCharacter.test(firstName)||firstName==""){verifyInput="Concernant votre prénom, Les caractères spéciaux et les chiffres ne sont pas autorisés."+"\n";}else{console.log("Input du prénom accepté");}
if(checkNumber.test(name)||checkSpecialCharacter.test(name)||name==""){verifyInput+="Concernant votre nom, Les caractères spéciaux et les chiffres ne sont pas autorisés."+"\n";}else{console.log("Input du nom accepté");}
if(checkSpecialCharacter.test(address)||address==""||address.length>150){verifyInput+="Concernant votre adresse, Les caractères spéciaux ne sont pas autorisés."+"\n";}else{console.log('Input de l\'adresse accepté');}
if(checkNumber.test(city)||checkSpecialCharacter.test(city)||city==""){verifyInput+="Concernant votre ville, Les caractères spéciaux et les chiffres ne sont pas autorisés."+"\n";}else{console.log('Input de la ville accepté');}
if(checkMail.test(email)==false){verifyInput+="E-mail non autorisé, veuillez vérifier vos informations";}else{console.log('e-mail accepté');}
if(verifyInput!=""){alert('Nous avons rencontrés des problèmes sur les informations que vous nous avez communiqué: '+'\n\n'+verifyInput)}else{console.log("Informations valides")
contact={firstName:firstName,lastName:name,address:address,city:city,email:email}
return true;}}
function postOrder(orderString){const options={method:"POST",headers:{'Accept':'application/json',"Content-Type":"application/json"},body:orderString}
fetch("http://localhost:3000/api/teddies/order",options).then((response)=>{if(response.ok){response.json().then((order)=>{localStorage.setItem('order',JSON.stringify(order));contact={};products=[];window.location='./confirmation.html';})}else{alert('Une erreur est survenue : Requête non acceptée \n'+'Status code de la réponse : '+response.status+' : '+response.statusText);}}).catch((err)=>console.log('erreur lors de la requette POST '+err));}
function validForm(products){let formContact=document.querySelector(".form-contact");formContact.addEventListener("submit",function(event){if(checkInput()==true){event.preventDefault();let order={contact,products};let orderString=JSON.stringify(order);postOrder(orderString);}
else{event.preventDefault();alert('Error : un problème est survenu lors de la vérification du formulaire');}});}