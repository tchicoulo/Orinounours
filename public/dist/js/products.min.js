"use strict";function getJsonId(){let queryString=window.location.search;const urlParams=new URLSearchParams(queryString);const nounoursId=urlParams.get("id");fetch("http://localhost:3000/api/teddies/"+nounoursId).then((response)=>{if(response.ok){response.json().then((data)=>{showProduct(data);addToCart(data);})}else{alert('Une erreur est survenue : Requête non acceptée \n'+'Status code de la réponse : '+response.status+' : '+response.statusText);}}).catch((err)=>console.log("erreur"+err));}
function showProduct(jsonId){let productContent=document.querySelector(".content_product_js");let productDivLeft=document.createElement("div");let productH2=document.createElement("h2");let productP=document.createElement("p");let productSelect=document.createElement("select");let productOptionHeading=document.createElement("option");let productPrice=document.createElement("h3");let productDivRight=document.createElement("div");let productImg=document.createElement("img");let productButton=document.createElement("button");productDivLeft.classList.add("product");productH2.classList.add("product__name");productP.classList.add("product__description");productSelect.classList.add("product__select");productPrice.classList.add("product__price");productDivRight.classList.add("product");productImg.classList.add("product__img");productButton.classList.add("product__add");productOptionHeading.setAttribute("disabled","true");productOptionHeading.setAttribute("selected",true);productImg.setAttribute("src",jsonId.imageUrl);productImg.setAttribute("alt","Image de "+jsonId.name);productH2.textContent=jsonId.name;productP.textContent=jsonId.description;productPrice.textContent="Prix : "+jsonId.price / 100+" €";productButton.textContent="Ajouter au panier";productDivLeft.appendChild(productH2);productDivLeft.appendChild(productP);productDivLeft.appendChild(productSelect);productDivLeft.appendChild(productPrice);productDivRight.appendChild(productImg);productDivRight.appendChild(productButton);productContent.appendChild(productDivLeft);productContent.appendChild(productDivRight);jsonId.colors.forEach((elem)=>{let productOption=document.createElement("option");productOption.innerHTML=elem;productSelect.appendChild(productOption);});productOptionHeading.textContent="Choisissez une couleur";productSelect.insertAdjacentElement("afterbegin",productOptionHeading);}
function addToCart(product){let boutonAdd=document.querySelector(".product__add");let productSelect=document.querySelector(".product__select");boutonAdd.addEventListener("click",function(){if(productSelect.selectedIndex!=0){cartNumbers(product);totalCost(product);}else{alert("Veuillez sélectionner une couleur");}});}
function onLoadCartNumbers(){let productNumbers=localStorage.getItem("cartNumbers");if(productNumbers){document.querySelector(".cart-numbers").textContent=productNumbers;}}
function cartNumbers(product){let productNumbers=localStorage.getItem("cartNumbers");productNumbers=parseInt(productNumbers);if(productNumbers){localStorage.setItem("cartNumbers",productNumbers+1);document.querySelector(".cart-numbers").textContent=productNumbers+1;}else{localStorage.setItem("cartNumbers",1);document.querySelector(".cart-numbers").textContent=1;}
setItems(product);}
function setItems(product){let productSelect=document.querySelector(".product__select");let colorSelected=productSelect.value;let cartItems=localStorage.getItem("productInCart");cartItems=JSON.parse(cartItems);if(cartItems!=null){if(cartItems[product.name]==undefined){cartItems={...cartItems,[product.name]:product,};}
if(cartItems[product.name].inCart==null){cartItems[product.name].inCart=0;}
cartItems[product.name].colors=colorSelected;cartItems[product.name].inCart+=1;}else{product.colors=colorSelected;product.inCart=1;cartItems={[product.name]:product,};}
localStorage.setItem("productInCart",JSON.stringify(cartItems));}
function totalCost(product){let cartCost=localStorage.getItem("totalCost");if(cartCost!=null){cartCost=parseInt(cartCost);localStorage.setItem("totalCost",cartCost+product.price / 100);}else{localStorage.setItem("totalCost",product.price / 100);}}
onLoadCartNumbers();getJsonId();